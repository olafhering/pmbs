# %arm seems to be missing armv6l/armv6hl
%define arm %arm armv6l armv6hl

%ifarch armv6l armv6hl
%if 0%{?suse_version} == 1310
# 13.1 kernel-obs-build installation takes hours, so only use chroot workers without kernel installation
Constraint: sandbox chroot
# chroot workers do not need kernel-obs-build, only KVM workers. Do not install it to speed up the build (install time) and prevent hang
VMinstall: !kernel-obs-build
%else
# 13.2 and later are OK with kernel-obs
VMinstall: kernel-obs-build
VMInstall: kernel-obs-build
%endif
%endif

# Avoid armv7 build error: "getbinaries: missing packages: kernel-obs-build"
%ifarch armv7l armv7hl
VMinstall: !kernel-obs-build
VMInstall: !kernel-obs-build
%endif

#AArch64 and armv6 are built using QEMU
%ifarch aarch64 armv6l armv6hl
%define qemu_user_space_build 1
%endif

%if "%qemu_user_space_build" == "1"
# Reenable armv6l build only on QEMU_ARM workers
Constraint: hostlabel QEMU_ARM
Macros:
%qemu_user_space_build 1
%_without_mono 1
:Macros
%endif

%ifarch armv6l armv6hl
# Prefer Mesa openGL ES libs instead of raspberry pi openGL ES libs
#Prefer: raspberrypi-gfx raspberrypi-gfx-devel
Prefer: -raspberrypi-userland -raspberrypi-userland-devel
Prefer: Mesa-libEGL1 Mesa-libEGL-devel Mesa-libGLESv1_CM1 Mesa-libGLESv1_CM-devel Mesa-libGLESv2-2 Mesa-libGLESv2-devel 
# omxplayer also provides ffmpeg libs, so prefer to use ffmpeg ones
Prefer: -omxplayer
%endif

%ifarch armv7l armv7hl
# raspberrypi 2 is armv7l, so prefer Mesa here
Prefer: Mesa-libEGL-devel
Prefer: -raspberrypi-gfx-devel raspberrypi-userland-devel
%endif

# Because of pkgconfig() type BuildRequires
Prefer: -libffmpeg_oldabi-devel

Prefer: opencv-devel
Prefer: vlc-devel

Prefer: libxml++26-devel

# Undo splitdebug:_debug in OBS:SLE_12:Backports
%if 0%{?suse_version} == 1315
%if 0%{?is_opensuse}
%else
RepoType: rpm-md:rsyncable
%endif
%endif

%if 0%{?suse_version} > 1320
%if 1
Prefer: libavcodec-devel
Prefer: libavdevice-devel
Prefer: libavfilter-devel
Prefer: libavformat-devel
Prefer: libavresample-devel
Prefer: libavutil-devel
Prefer: libpostproc-devel
Prefer: libswresample-devel
Prefer: libswscale-devel
%endif
# Avoid conflict between libffmpeg_oldabi and ffmpeg2
#refer: ffmpeg2-devel
%endif

%if 0%{?suse_version} == 1320
# Avoid conflict between ffmpeg-2.8 and ffmpeg-3.0
Prefer: libavcodec-3.0-devel
Prefer: libavdevice-3.0-devel
Prefer: libavfilter-3.0-devel
Prefer: libavformat-3.0-devel
Prefer: libavresample-3.0-devel
Prefer: libavutil-3.0-devel
Prefer: libpostproc-3.0-devel
Prefer: libswresample-3.0-devel
Prefer: libswscale-3.0-devel
Prefer: -libswscale-devel
# vtk needs libjawt.so
Prefer: java-1_7_0-openjdk-headless
%endif
#
%if 0%{?suse_version} == 1315
%if 0%{?is_opensuse}
#
%if 0%{?sle_version} == 120200
# Leap 42.2
%endif
#
%if 0%{?sle_version} == 120100
# Leap 42.1
# Avoid conflict between ffmpeg-2.8 and ffmpeg from leap
Prefer: -libavcodec-devel
Prefer: -libavdevice-devel
Prefer: -libavfilter-devel
Prefer: -libavformat-devel
Prefer: -libavresample-devel
Prefer: -libavutil-devel
Prefer: -libpostproc-devel
Prefer: -libswresample-devel
Prefer: -libswscale-devel
# Avoid conflict between ffmpeg.rpm and ffmpeg-3.2.rpm
Prefer: ffmpeg-3.2
# Avoid conflict between ffmpeg-2.8 and ffmpeg-3.2
Prefer: libavcodec-3.2-devel
Prefer: libavdevice-3.2-devel
Prefer: libavfilter-3.2-devel
Prefer: libavformat-3.2-devel
Prefer: libavresample-3.2-devel
Prefer: libavutil-3.2-devel
Prefer: libpostproc-3.2-devel
Prefer: libswresample-3.2-devel
Prefer: libswscale-3.2-devel
%endif
# !Leap
%else
# SLE12
# For missing-provides-SLE_12.spec
Prefer: libImath-2_1-11
Prefer: libconfig9
Prefer: libglut3
Prefer: libmcrypt
Prefer: libmicrohttpd10
Prefer: librdmacm1
Prefer: libvncclient0
Prefer: libwx_gtk2u_core-2_8-0-compat-lib-stl
Prefer: oxygen5-icon-theme
Prefer: liblirc_client0
Prefer: libcddb2
# Avoid conflict between ffmpeg-2.8 and ffmpeg from Backports
Prefer: -libavcodec-devel
Prefer: -libavdevice-devel
Prefer: -libavfilter-devel
Prefer: -libavformat-devel
Prefer: -libavresample-devel
Prefer: -libavutil-devel
Prefer: -libpostproc-devel
Prefer: -libswresample-devel
Prefer: -libswscale-devel
# Avoid conflict between ffmpeg.rpm and ffmpeg-3.2.rpm
Prefer: ffmpeg-3.2
# Avoid conflict between ffmpeg-2.8 and ffmpeg-3.2
Prefer: libavcodec-3.2-devel
Prefer: libavdevice-3.2-devel
Prefer: libavfilter-3.2-devel
Prefer: libavformat-3.2-devel
Prefer: libavresample-3.2-devel
Prefer: libavutil-3.2-devel
Prefer: libpostproc-3.2-devel
Prefer: libswresample-3.2-devel
Prefer: libswscale-3.2-devel
%endif
#
%endif
#
%if 0%{?suse_version} == 1310
# Avoid conflict between ffmpeg-2.8 and ffmpeg-3.0
Prefer: libavcodec-3.0-devel
Prefer: libavdevice-3.0-devel
Prefer: libavfilter-3.0-devel
Prefer: libavformat-3.0-devel
Prefer: libavresample-3.0-devel
Prefer: libavutil-3.0-devel
Prefer: libpostproc-3.0-devel
Prefer: libswresample-3.0-devel
Prefer: libswscale-3.0-devel
Prefer: -libswscale-devel
%endif
#

Prefer: liborc-0_4-0

# Support pkgconfig() BuildRequires in old distros
#
%if 0%{?suse_version} == 1320
Substitute: pkgconfig(form) ncurses-devel=
Substitute: pkgconfig(form6) ncurses-devel=
Substitute: pkgconfig(formw) ncurses-devel=
Substitute: pkgconfig(formw6) ncurses-devel=
Substitute: pkgconfig(menu) ncurses-devel=
Substitute: pkgconfig(menu6) ncurses-devel=
Substitute: pkgconfig(menuw) ncurses-devel=
Substitute: pkgconfig(menuw6) ncurses-devel=
Substitute: pkgconfig(ncurses) ncurses-devel=
Substitute: pkgconfig(ncurses++) ncurses-devel=
Substitute: pkgconfig(ncurses++6) ncurses-devel=
Substitute: pkgconfig(ncurses++w) ncurses-devel=
Substitute: pkgconfig(ncurses++w6) ncurses-devel=
Substitute: pkgconfig(ncurses6) ncurses-devel=
Substitute: pkgconfig(ncursesw) ncurses-devel=
Substitute: pkgconfig(ncursesw6) ncurses-devel=
Substitute: pkgconfig(panel) ncurses-devel=
Substitute: pkgconfig(panel6) ncurses-devel=
Substitute: pkgconfig(panelw) ncurses-devel=
Substitute: pkgconfig(panelw6) ncurses-devel=
Substitute: pkgconfig(tic) ncurses-devel=
Substitute: pkgconfig(tic6) ncurses-devel=
Substitute: pkgconfig(tinfo) ncurses-devel=
Substitute: pkgconfig(tinfo6) ncurses-devel=
Substitute: pkgconfig(libcap) libcap-devel=
%endif
#
%if 0%{?suse_version} == 1315
Substitute: pkgconfig(tinfo) ncurses-devel=
Substitute: pkgconfig(libcap) libcap-devel=
%endif
#
%if 0%{?suse_version} == 1310
Substitute: pkgconfig(libmikmod) libmikmod-devel=
Substitute: pkgconfig(libcap) libcap-devel=
%endif
#
%if 0%{?suse_version} > 1010
Support:    build-compare
%endif

%define BUILD_ORIG 1
%define BUILD_ORIG_ADDON 1
%define _with_LV2 1
%define _with_a52 1
%define _with_aalib 1
%define _with_amrnb 1
%define _with_amrwb 1
%define _with_dcadec 1
%define _with_directfb 1
%define _with_esd 1
%define _with_faac 1
%define _with_faad 1
%define _with_fdk_aac 1
%define _with_ffmpeg 1
%define _with_gme 1
%define _with_gnome_vfs 1
%define _with_jack 1
%define _with_lame 1
%define _with_libdca 1
%define _with_libmpeg2 1
%define _with_librtmp 1
%define _with_libsidplay2 1
%define _with_mad 1
%define _with_modplug 1
%define _with_mpg123 1
%define _with_mpv_gpl3 1
%define _with_pulseaudio 1
%define _with_restricted 1
%define _with_sdl 1
%define _with_shine 1
%define _with_twolame 1
%define _with_vo_aacenc 1
%define _with_vidstab 1
%define _with_wayland 1
%define _with_x264 1
%define _with_x265 1
%define _with_xvid 1
%define _without_distributable 1
%define _without_onlynondistributable 1
%define _without_wayland 1

Macros:
%vendor http://packman.links2linux.de
%packager packman@links2linux.de
%packman_bs 1
%BUILD_ORIG 1
%BUILD_ORIG_ADDON 1
%_with_LV2 1
%_with_a52 1
%_with_aalib 1
%_with_amrnb 1
%_with_amrwb 1
%_with_dcadec 1
%_with_directfb 1
%_with_esd 1
%_with_faac 1
%_with_faad 1
%_with_fdk_aac 1
%_with_ffmpeg 1
%_with_gme 1
%_with_gnome_vfs 1
%_with_jack 1
%_with_lame 1
%_with_libdca 1
%_with_libmpeg2 1
%_with_librtmp 1
%_with_libsidplay2 1
%_with_mad 1
%_with_modplug 1
%_with_mpg123 1
%_with_mpv_gpl3 1
%_with_pulseaudio 1
%_with_restricted 1
%_with_sdl 1
%_with_shine 1
%_with_twolame 1
%_with_vo_aacenc 1
%_with_vidstab 1
%_with_x264 1
%_with_x265 1
%_with_xvid 1
%_without_crippled_stk 1
%_without_distributable 1
%_without_onlynondistributable 1
:Macros

# Factory
%if 0%{?suse_version} > 1320
%define _without_freerdp 1
Macros:
%_without_freerdp 1
:Macros
%endif
#
#
%if 0%{?suse_version} == 1320
%define _with_vlc_atmo 1
%define _without_vlc_svgdec 1
%define _without_zbar 1
Macros:
%_with_vlc_atmo 1
%_without_vlc_svgdec 1
%_without_zbar 1
:Macros
%endif
#
#
%if 0%{?suse_version} == 1315
%if 0%{?is_opensuse}
#
%if 0%{?sle_version} == 120200
# Leap 42.2
%define _without_freerdp 1
%define _with_vlc_atmo 1
%define _without_vlc_ncurses 1
Macros:
%_without_freerdp 1
%_with_vlc_atmo 1
%_without_vlc_ncurses 1
:Macros
%endif
#
%if 0%{?sle_version} == 120100
# Leap 42.1
%ifarch %ix86
# no netcdf-32bit
%define _without_netcdf 1
Macros:
%_without_netcdf 1
:Macros
%endif
%define _with_vlc_atmo 1
%define _without_vlc_ncurses 1
Macros:
%_with_vlc_atmo 1
%_without_vlc_ncurses 1
:Macros
%endif
# !Leap
%else
# SLE12
%define _with_vlc_atmo 1
%define _without_freerdp 1
%define _without_gpac 1
%define _without_graphicsmagic 1
%define _without_vlc_kde4 1
%define _without_vlc_ncurses 1
%define _without_vlc_svgdec 1
%define _without_zbar 1
Macros:
%_with_vlc_atmo 1
%_without_freerdp 1
%_without_gpac 1
%_without_graphicsmagic 1
%_without_vlc_kde4 1
%_without_vlc_ncurses 1
%_without_vlc_svgdec 1
%_without_zbar 1
:Macros
%endif
%endif
#
#
%if 0%{?suse_version} == 1310
%define _with_vlc_atmo 1
%define _without_vlc_ncurses 1
%define _without_vlc_svgdec 1
Macros:
%_with_vlc_atmo 1
%_without_vlc_ncurses 1
%_without_vlc_svgdec 1
:Macros
%endif
#
#
